<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/db_query - Space Station 13</title></head><body><header><a href="index.html">Space Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/db_query.html#var">Var Details</a> - <a href="datum/db_query.html#proc">Proc Details</a></header><main><h1>db_query <aside>/<a href="datum.html">datum</a>/<a href="datum/db_query.html">db_query</a></aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L311"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 311"></a></h1><p>Datum based handler for all database queries</p>
<p>Holds information regarding inputs, status, and outputs</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/db_query.html#var/affected">affected</a></th><td>How many rows were affected by the query</td></tr><tr><th><a href="datum/db_query.html#var/arguments">arguments</a></th><td>An associative list of parameters to be substituted into the statement</td></tr><tr><th><a href="datum/db_query.html#var/connection">connection</a></th><td>The connection being used with this query</td></tr><tr><th><a href="datum/db_query.html#var/in_progress">in_progress</a></th><td>Is the query currently in progress</td></tr><tr><th><a href="datum/db_query.html#var/item">item</a></th><td>List of data values populated by NextRow()</td></tr><tr><th><a href="datum/db_query.html#var/last_activity">last_activity</a></th><td>What was our last activity</td></tr><tr><th><a href="datum/db_query.html#var/last_activity_time">last_activity_time</a></th><td>When was our last activity</td></tr><tr><th><a href="datum/db_query.html#var/last_error">last_error</a></th><td>What was our last error, if any</td></tr><tr><th><a href="datum/db_query.html#var/last_insert_id">last_insert_id</a></th><td>ID of the last inserted row</td></tr><tr><th><a href="datum/db_query.html#var/next_row_to_take">next_row_to_take</a></th><td>Counter of the next row to take</td></tr><tr><th><a href="datum/db_query.html#var/rows">rows</a></th><td>List of all rows returned</td></tr><tr><th><a href="datum/db_query.html#var/sql">sql</a></th><td>The SQL statement being executed with :parameter placeholders</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/db_query.html#proc/Activity">Activity</a></th><td>Activity Update Handler</td></tr><tr><th><a href="datum/db_query.html#proc/Execute">Execute</a></th><td>Main Execution Handler</td></tr><tr><th><a href="datum/db_query.html#proc/NextRow">NextRow</a></th><td>Proc to get the next row in a DB query</td></tr><tr><th><a href="datum/db_query.html#proc/run_query">run_query</a></th><td>Actual Query Runner</td></tr><tr><th><a href="datum/db_query.html#proc/warn_execute">warn_execute</a></th><td>Wrapped for warning on execution</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/affected"><aside class="declaration">var </aside>affected <aside>– </aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L336"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 336"></a></h3><p>How many rows were affected by the query</p><h3 id="var/arguments"><aside class="declaration">var </aside>arguments <aside>– </aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L318"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 318"></a></h3><p>An associative list of parameters to be substituted into the statement</p><h3 id="var/connection"><aside class="declaration">var </aside>connection <aside>– </aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L314"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 314"></a></h3><p>The connection being used with this query</p><h3 id="var/in_progress"><aside class="declaration">var </aside>in_progress <aside>– </aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L322"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 322"></a></h3><p>Is the query currently in progress</p><h3 id="var/item"><aside class="declaration">var </aside>item <aside>– /list</aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L343"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 343"></a></h3><p>List of data values populated by NextRow()</p><h3 id="var/last_activity"><aside class="declaration">var </aside>last_activity <aside>– </aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L326"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 326"></a></h3><p>What was our last activity</p><h3 id="var/last_activity_time"><aside class="declaration">var </aside>last_activity_time <aside>– </aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L328"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 328"></a></h3><p>When was our last activity</p><h3 id="var/last_error"><aside class="declaration">var </aside>last_error <aside>– </aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L324"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 324"></a></h3><p>What was our last error, if any</p><h3 id="var/last_insert_id"><aside class="declaration">var </aside>last_insert_id <aside>– </aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L338"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 338"></a></h3><p>ID of the last inserted row</p><h3 id="var/next_row_to_take"><aside class="declaration">var </aside>next_row_to_take <aside>– </aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L334"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 334"></a></h3><p>Counter of the next row to take</p><h3 id="var/rows"><aside class="declaration">var </aside>rows <aside>– /list/list</aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L332"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 332"></a></h3><p>List of all rows returned</p><h3 id="var/sql"><aside class="declaration">var </aside>sql <aside>– </aside> <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L316"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 316"></a></h3><p>The SQL statement being executed with :parameter placeholders</p><h2 id="proc">Proc Details</h2><h3 id="proc/Activity"><aside class="declaration">proc </aside>Activity<aside>(activity)  <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L371"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 371"></a></aside></h3><p>Activity Update Handler</p>
<p>Sets the last activity text to the argument input, as well as updating the activity time</p>
<p>Arguments:</p>
<ul>
<li>activity - Last activity text</li>
</ul><h3 id="proc/Execute"><aside class="declaration">proc </aside>Execute<aside>(async, log_error)  <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L403"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 403"></a></aside></h3><p>Main Execution Handler</p>
<p>Invoked by [warn_execute()]
This handles query error logging, as well as invoking the actual runner
Arguments:</p>
<ul>
<li>async - Are we running this query asynchronously</li>
<li>log_error - Do we want to log errors this creates? Disable this if you are running sensitive queries where you dont want errors logged in plain text (EG: Auth token stuff)</li>
</ul><h3 id="proc/NextRow"><aside class="declaration">proc </aside>NextRow<aside>()  <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L474"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 474"></a></aside></h3><p>Proc to get the next row in a DB query</p>
<p>Cycles <code>item</code> to the next row in the DB query, if multiple were fetched</p><h3 id="proc/run_query"><aside class="declaration">proc </aside>run_query<aside>(async)  <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L435"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 435"></a></aside></h3><p>Actual Query Runner</p>
<p>This does the main query with the database and the rust calls themselves</p>
<p>Arguments:</p>
<ul>
<li>async - Are we running this query asynchronously</li>
</ul><h3 id="proc/warn_execute"><aside class="declaration">proc </aside>warn_execute<aside>(async, log_error)  <a href="https://github.com/ParadiseSS13/Paradise/blob/9adbe3948ad40c9630db40596a8958a5d940a2cb/code/controllers/subsystem/SSdbcore.dm#L384"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/SSdbcore.dm 384"></a></aside></h3><p>Wrapped for warning on execution</p>
<p>You should use this proc when running the SQL statement. It will auto inform the user and the online admins if a query fails</p>
<p>Arguments:</p>
<ul>
<li>async - Are we running this query asynchronously</li>
<li>log_error - Do we want to log errors this creates? Disable this if you are running sensitive queries where you dont want errors logged in plain text (EG: Auth token stuff)</li>
</ul></main><footer>paradise.dme <a href="https://github.com/ParadiseSS13/Paradise/tree/9adbe3948ad40c9630db40596a8958a5d940a2cb">9adbe39</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.9.0</a></footer></body></html>